---
title: 'Master EFT: pédologie de la P16 de Paracou'
author: "Clément Thion, Emilie Sanvito, Greta Dobetsberger"
date: "2023-09-25"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

# INTRODUCTION

## DATA DESCRIPTION

Organisation of data files: there is separate sheet for each 4 pit data.
In each sheet, you have the same 11 variables:

3 variables serve for location of observation: - pit: the pit number,
corresponding to the order in which it was dug - depth: depth in the
pit, from 0cm to 100cm, by 20cm step - side: side of observation in the
pit. There is two sides for each pit. The orientation of the side is
indicated. Side's number correspond to the order of counting (S1 has
been counted before S2)

Then for each combination value of (pit, side, depth), we have measured
and observed the next variables: - root1 ... root4: the amount of root
for 4 diameter classes, counted in a square of 50cm long by 10cm deep,
located at (pit, side, depth) - texture: the texture of the horizon -
micas: the qualitative approximation of the amount of micas in the
horizon, from 0 (no micas at all) to 3 (a lot of micas) - stoneContent:
the percentage of stone content in the horizon - taches: in percentages

MANQUE LES VARIABLES PAS ENCORE RETRANSCRITES DANS EXCEL

## GOALS OF THIS ANALYSIS

The goals of the code in this file is to study, in the ground of
tropical forest (P16 Paracou) the link between the root abundance and
soil texture, and specialy the occurence of silt horizon.

```{r}
library(readxl)
library(tidyverse)
library(ggplot2)
library(corrplot)
library(FactoMineR) # Pour l'analyse en composantes principales
library(factoextra) # Pour la représentation de l'ACP
```

```{r}
#--import data of each pit
dataPitF1 <- read_excel("FOSSE 1-4.xlsx", sheet=1, na="NA")
dataPitF2 <- read_excel("FOSSE 1-4.xlsx", sheet=2, na="NA")
dataPitF3 <- read_excel("FOSSE 1-4.xlsx", sheet=3, na="NA")
dataPitF4 <- read_excel("FOSSE 1-4.xlsx", sheet=4, na="NA")
dataPitF1$pit <- rep("F1", 100); dataPitF2$pit <- rep("F2", 100); dataPitF3$pit <- rep("F3", 100); dataPitF4$pit <- rep("F4", 100) #add a the variable pit to distinguish each sheet data before merging them

dataPit <- rbind(dataPitF1, dataPitF2, dataPitF3, dataPitF4)#merge them in one unique dataframe
remove(dataPitF1, dataPitF2, dataPitF3, dataPitF4) #remove separated sheets

#--convert depth code (P1 to P10) to their corresponding depth value (10 to 100cm)
dataPit$depth <- as.factor(dataPit$depth)
levels(dataPit$depth) <- c("10", "20", "30", "40", "50", "60", "70", "80", "90", "100")

#--we split the side variable into two different one: sideOrient and sideNumber
dataPit$exposure <- as.factor(dataPit$exposure)
dataPit$exposure_orient <- substr(dataPit$exposure, 8, 20)#create side Orient and sideNumber
dataPit$exposure_number <- substr(dataPit$exposure, 6, 7)
dataPit <- dataPit[,!names(dataPit) =="exposure"]#remove side variable since it has been split

#--
dataPit$rd1 <- as.numeric(dataPit$rd1)
dataPit$rd2 <- as.numeric(dataPit$rd2)
dataPit$rd3 <- as.numeric(dataPit$rd3)
dataPit$rd4 <- as.numeric(dataPit$rd4)
dataPit$texture <- as.factor(dataPit$texture)
dataPit$micas <- as.factor(dataPit$micas)
dataPit$coarse_element <- as.numeric(dataPit$coarse_element) #WARNING, only 11 differents values
dataPit$water_reserve <- as.numeric(dataPit$water_reserve)
dataPit$humidity <- as.factor(dataPit$humidity)
dataPit$structure_type <- as.factor(dataPit$structure_type)
dataPit$structure_size <- as.numeric(dataPit$structure_size)
dataPit$density <- as.factor(dataPit$density)
dataPit$smudges <- as.numeric(dataPit$smudges) #WARNING, only 5 differents values
dataPit$colour1 <- as.factor(dataPit$colour1)
dataPit$colour2 <- as.factor(dataPit$colour2)
dataPit$pit <- as.factor(dataPit$pit)
dataPit$exposure_orient <- as.factor(dataPit$exposure_orient)
dataPit$exposure_number <- as.factor(dataPit$exposure_number)
```

### Calculation of water reserve

$$
WR=\sum_{h} T_h\ R_h\ (1-C_h)
$$ 

with, for a ginven horizon $h$:

-   $R_h$ the usefull reserve (available in *Jamagne et al., 1977*).
    Require the texture of the horizon.
-   $C_h$ the percentage of coarse element (estimated on the field)
-   $T_h$ the thickness of the horizon

During our field campaign, we tried to estimate the percentage of coarse element
in each horizon, but the estimation was not really accurate. Then we decided to regroup coarse element data into three classes: C<0.1, 0.1<C<0.4, 0.4<C.
For each class we choose the mean of coarse element as value, wich will be used
in the calculation of water reserve. 
This new coarse element variable is considered as an qualitative ordinal variable.

```{r}
R_value <- c(0.70, 1.00,	1.35,	1.20,	1.45,	1.60,	1.65,	1.75,	1.30,	1.75,	1.95,	1.70,	1.75,	1.80,	1.65) #values get from Jamagne et al. 1977
R_texture <- c("S",	"SL",	"SA",	"LIS"	,"LS",	"LmS",	"LSA",	"LAS",	"Ll",	"Lm",	"LA",	"AS",	"A",	"AL",	"Alo")#corresponding texture class for each R_value

dataPit$coarse_element_class <- dataPit$coarse_element #initialize variable

dataPit$coarse_element_class[dataPit$coarse_element>=0.4]<-mean(dataPit$coarse_element_class[dataPit$coarse_element>=0.4]) #first class

dataPit$coarse_element_class[between(dataPit$coarse_element,0.1,0.4)]<-mean(dataPit$coarse_element_class[dataPit$coarse_element<0.4])#second class

dataPit$coarse_element_class[dataPit$coarse_element<=0.1]<-mean(dataPit$coarse_element_class[dataPit$coarse_element<=0.1])#last class

dataPit$coarse_element_class <- as.ordered(dataPit$coarse_element_class)
summary(dataPit$coarse_element_class)

#miss only the horizon thickness part: need to regroupe data by horizon !
```

## Reorganisation of data

```{r}
dataPitHorizon <- dataPit %>%
  pivot_wider(
    names_from = pit, 
    names_sep = ".",
    values_from = c(texture)
      )
```

# not directed analysis

```{r}
dataPit %>% # Dans donnees sols
  select_if(is.numeric) %>% # On ne sélectionne que les colonnes numériques
  cor() %>% # On calcule la matrice de corrélation empirique
  corrplot() # Puis on représente graphiquement cette matrice
```

```{r}
dataPitNorm <- dataPit %>% 
  select_if(is.numeric) %>% #On ne sélectionne que les colonnes numériques
  select(!stoneElement) %>%
  mutate_all(.funs = scale) # On applique à touts les colonnes la fonction scale
# La fonction scale centre et réduit un vecteur
# donnees_reduites # Toujours regarder ce qu'on a créé!

acpRes <- PCA(dataPitNorm, 
               scale.unit = TRUE, # Option pour centrer et réduire les données
               ncp = 18, # Nombre de composantes à conserver
               graph = FALSE)

acpRes

fviz_eig(acpRes, choice = "variance")

# Représentation dans le premier plan_principal
fviz_pca_var(acpRes,
             axes = c(1, 2)) # Numéro des axes à représenter 
fviz_pca_var(acpRes,
             axes = c(1, 3)) #
fviz_pca_var(acpRes,
             axes = c(2, 3)) # 
fviz_pca_var(acpRes,
             axes = c(1, 4))

corrplot(acpRes$var$cor)

# Représentation dans le premier plan_principal
fviz_pca_ind(acpRes,
             axes = c(1, 2)) # Numéro des axes à représenter 

# Représentation dans le premier plan_principal
fviz_pca_ind(acpRes,
             axes = c(1, 2), # Numéro des axes à représenter 
             col.ind = dataPit$texture) # Variable suppl. pour les individus

# Représentation dans le premier plan_principal
fviz_pca_ind(acpRes,
             axes = c(1, 2), # Numéro des axes à représenter 
             col.ind = dataPit$depth)
```

analyser l'évolution de l'écart au dessus / dedans de l'horizon
limoneux.

Projet ALT: à échelle Amazonienne: prévenir l'évolution des forêts
amazonienne en fonction changement climatique et antropiques. Basé sur
simulateur Troll (basé sur arbre adulte) & sur modélateur fait par
Vinciane sur l'impacte de l'exploitation forestière.

Problème de la considération des arbres "adultes" (DBH\>10cm). ==\> obj
est de prendre en compte les juvéniles

Thèse Vinciane Comprendre quels sont les besoins environnementaux des
arbres de sous-bois ==\> mesure de pleins de données environnementales
différentes (lumière humidité ect). Existence de niche écologique ?

Hypothèse de l'effet de la topographie sur la pédologie.

regarder s'il y a une correlation entre la presence des mica et les
limons.
