---
title: "pedo_Auger_Analsysis"
author: "EmilieSanvito"
date: "2023-10-05"
output: html_document
---
###Pedologie projet

##data organization

```{r libraries}
rm(list=ls()) #to empty your work environment


library(tidyverse)
library(readxl)
library(dplyr)

#install.packages("ggforce")
library(ggforce)   #look again why I used it
library(knitr)

library(geosphere)  #library for calculating distances of latitudes


#install.packages("memoiR")
#library(memoiR)

```

```{r upload and structure data}

dataAugur2022 <- read_excel("DataAuger2022.xlsx", na = "NA")   #import data from last year project (36 augur in the P16)

dataBotany2022_NA <- read_excel("DataAuger2022.xlsx", na = "NA", sheet = "Data Giacomo")  #import botany data
dataBotany2022 <- dataBotany2022_NA %>% 
  na.omit  #remove NA objects

```

```{r rename titles in data}

dataAugur2022 <- dataAugur2022 %>% rename_at('% pente', ~'pente')
dataAugur2022 <- dataAugur2022 %>% rename_at('Numéro horizon', ~'horizon')
dataAugur2022 <- dataAugur2022 %>% rename_at('profondeur limite inférieure (cm)2', ~'depth_inf')
dataAugur2022 <- dataAugur2022 %>% rename_at('profondeur limite supérieure (cm)', ~'depth_sup')
dataAugur2022 <- dataAugur2022 %>% rename_at('Epaisseur (cm)', ~'epaisseur')
dataAugur2022 <- dataAugur2022 %>% rename_at('Texture corrigée 2023', ~'Texture_2023')  #idk why it doesn't work here
dataAugur2022 <- dataAugur2022 %>% rename_at('EG %', ~'stone_elements')
dataAugur2022 <- dataAugur2022 %>% rename_at('Réserve eau utile (mm) NEW...35', ~'water_reservoir')

```


Make a new column in which the textures are grouped based on the importance of silt present:

```{r}
#filter out all data that isn't on the slope (drainage type DLS) and make smaller usable dataframe
Augur_NA <- dataAugur2022 %>% filter(Classification == "Drainage latéral superficiel") %>%
  select(c("sondage_N", "Texture_2023", "depth_sup", "arbre_plus_proche")) 
 
#take out NA variables
Augur <- Augur_NA %>% 
  na.omit   

#create new column with textures divided in three classes based upon their presence of silt
Augur$Silt_class <- ifelse(Augur$Texture_2023 %in% c("A", "Alo", "AS"), "low", ifelse(Augur$Texture_2023 %in% c("SL", "SA", "S"), "intermediate", "high"))


#make a more precise df with variables we will use
Botany <- dataBotany2022 %>% 
  select(c("TreeID", "Family", "Genus", "species", "Xutm", "Yutm")) 
```


```{r define silt appearance depth}

#creata dataframe in which for every augur point you have defined depth at which silt concentration becomes high
df_restructured <- Augur %>% 
  group_by(sondage_N) %>%     #group by augur
  filter(Silt_class == "high") %>%    #get only augurs for which the silt concentration is high
  arrange(sondage_N, depth_sup) %>%     #arrange the data so that every measurment in one augur is arranged with depth
  distinct(sondage_N, .keep_all = TRUE) %>%  #keep only one value per augur (the first depth)
  select(sondage_N,depth_sup, arbre_plus_proche) %>% #maintain only three variables from the dataframe
  merge(Botany, by.x = 'arbre_plus_proche', by.y = 'TreeID' )   #merge with botany dataframe for common values of treeID and arbre plus proch

df_restructured$sondage_N <- as.numeric(df_restructured$sondage_N)

```

Create dataframe where points are grouped by distance from center point (arbre_plus_proche)

```{r create good buffer dataframe}

#write_csv(Botany, "Botany_export.csv")      
#export data to QGis

#upload data that contains zones of 5m around center augur points
Buffer_points <- read.csv("final_bufferpoints.csv")

AGB_buffer <- Buffer_points %>%
  group_by(sondage_N) %>%
  summarise(amount_trees = n(),
            sp_richness = n_distinct(species) 
            )

Final_df <- df_restructured %>%
  select(sondage_N, depth_sup) %>%
  merge(AGB_buffer, by.x = 'sondage_N', by.y = 'sondage_N' )

  
  
#result <- Buffer_points %>%
#  group_by(sondage_N, Family) %>%
# summarise(count = n()) %>%
# arrange(desc(count)) %>%
# slice(1) %>%
# ungroup() %>%
#group_by(sondage_N) %>%
# summarise(most_abundant_family = Family[1], 
#           most_abundant_count = count[1],
#           total_families_seen = n_distinct(Family))


```

## data visualisation

```{r}
ggplot(Final_df$depth_sup, Final_df$amount_trees)
plot(Final_df$depth_sup, Final_df$amount_trees)
plot(Final_df$depth_sup, Final_df$sp_richness )
```


## test if there is an effect of the depth of the silt horizon appearance on the number of trees




## extra

```{r code to find package of a function}
#install.packages("sos")  #package for function find Fn,
library(sos)
findFn("geosphere")  #function to learn which package is necessary for your function
```



Idea now is to check link between texture_class and the aboveground biomass


