---
title: "pedo_Auger_Analsysis"
author: "EmilieSanvito"
date: "2023-10-05"
output: html_document
---


```{r libraries}
rm(list=ls()) #to empty your work environment

library(tidyverse)
library(readxl)
library(dplyr)

#install.packages("ggforce")
library(ggforce)   #look again why I used it

```

```{r upload and structure data}

dataAugur2022 <- read_excel("DataAuger2022.xlsx", na = "NA")   #import data from last year project (36 augur in the P16)
dataBotany2022_NA <- read_excel("DataAuger2022.xlsx", na = "NA", sheet = "Data Giacomo")  #import botany data
dataBotany2022 <- dataBotany2022_NA %>% na.omit

```

```{r rename titles in data}

dataAugur2022 <- dataAugur2022 %>% rename_at('% pente', ~'pente')
dataAugur2022 <- dataAugur2022 %>% rename_at('Numéro horizon', ~'horizon')
dataAugur2022 <- dataAugur2022 %>% rename_at('profondeur limite inférieure (cm)2', ~'depth_inf')
dataAugur2022 <- dataAugur2022 %>% rename_at('profondeur limite supérieure (cm)', ~'depth_sup')
dataAugur2022 <- dataAugur2022 %>% rename_at('Epaisseur (cm)', ~'epaisseur')
dataAugur2022 <- dataAugur2022 %>% rename_at('Texture corrigée 2023', ~'Texture_2023')  #idk why it doesn't work here
dataAugur2022 <- dataAugur2022 %>% rename_at('EG %', ~'stone_elements')
dataAugur2022 <- dataAugur2022 %>% rename_at('Réserve eau utile (mm) NEW...35', ~'water_reservoir')

```


make a new column in which the textures are grouped based on the importance of silt present:

```{r}
Augur_NA <- dataAugur2022 %>% filter(Classification == "Drainage latéral superficiel") %>% select(c("sondage_N", "Texture_2023", "depth_sup", "arbre_plus_proche")) 
 #filter out all data that isn't on the slope (drainage type DLS) and make smaller usable dataframe
Augur <- Augur_NA %>% na.omit   #take out NA variables

Augur$Texture_class <- ifelse(Augur$Texture_2023 %in% c("A", "Alo", "AS", "SA", "S"), "C", ifelse(Augur$Texture_2023 == "SL", "B", "A"))  #create new column with textures divided in three classes based upon their presence of silt
#class A has most amount of silt, class C has least amount of silt

Augur$Texture_simplified <- ifelse(Augur$Texture_2023 %in% c("A", "Alo", "AS", "SA", "SL", "S"), "B", "A")

Botany <- dataBotany2022 %>% select(c("TreeID", "Family", "Genus", "species", "Xutm", "Yutm"))   #make a more precise df with variables we will use

Botany_augur <- merge(Augur, Botany, by.x = 'arbre_plus_proche', by.y = 'TreeID')   #create a merged dataframe of both the botany and the augur data based on the columns "arbre_plus_proche" and "TreeID"

```


```{r visualize augur points}

ggplot(data = Botany_augur, aes(Xutm, Yutm)) + geom_point()   #a plot to show all the augur measurements on a "map"

```
```{r}
?wich   #fucntion to get line number of your data with a specific condition
```

```{r}

df_restructured <- Augur %>% group_by(sondage_N) %>% filter(Texture_simplified == "A") %>% arrange(sondage_N, depth_sup) %>% distinct(sondage_N, .keep_all = TRUE) %>% select(sondage_N,depth_sup, arbre_plus_proche)

# remade a df in which for each augur measurement the depth at which the silt occurs in high quantities (so class A) is noted down

df_merged_restructured <- merge(df_restructured, Botany, by.x = 'arbre_plus_proche', by.y = 'TreeID')   #create a merged dataframe of both the botany and the augur data based on the columns "arbre_plus_proche" and "TreeID" ; this time in which the data is not repeated for all the horizons

```

```{r group plots with buffer per auger}
#take all data that is found within buffer length of a certain tree

radius <- 50
xCenter_radius <- 285444 - radius
xCenter <- 285444 + radius
yCenter <- 581493.6 + radius
yCenter_radius <- 581493.6 - radius


coord <- cbind("longitude" = dataBotany2022$Xutm/1000, "latitude" = dataBotany2022$Yutm/1000)
str(coord)


library(geosphere)   #library for geopshere function
coord_df <- data.frame(coord, 
                       within_5km = geosphere::distHaversine(
                           coord, 
                           c(28.5444, 58.14936)
                           )/1000 < 1)    #convert m to km, check < 5


table(coord_df$within_1km)


Circle_x <- dataBotany2022$Xutm[dataBotany2022$Xutm >= xCenter_radius & dataBotany2022$Xutm <= xCenter]  #all x coordinates in between X value of augur minus and plus buffer
Circle_y <- dataBotany2022$Yutm[dataBotany2022$Yutm >= yCenter_radius & dataBotany2022$Yutm <= yCenter]  #all y coordinates in between Y value of augur minus and plus buffer

Xvariables_withinbuffer <- dataBotany2022 %>% filter(Xutm %in% Circle_x)  #filter only x coordinates from botany data that are present in the common_x variable
length(Xvariables_withinbuffer$TreeID)

YandX_variableswithinbuffer <- Xvariables_withinbuffer %>% filter(Yutm %in% Circle_y) #same for Y values
length(YandX_variableswithinbuffer$TreeID)

dataBotany2022 %>% filter(Xutm == Xvariables_withinbuffer, Yutm == Yvariables_withinbuffer) 

A <- c(1,2,34,55,45,654,22,3,4,5)
B <- c(1,33,43, 654, 22, 9,8)
common <- A[(A %in% B)]
common


```


```{r code to find package of a function}
#install.packages("sos")  #package for function find Fn,
library(sos)
findFn("geosphere")  #function to learn which package is necessary for your function
```




Idea now is to check link between texture_class and the aboveground biomass



